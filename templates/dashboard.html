<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard - Market Alerts</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Market Alerts</a>
    <div class="d-flex">
      <span class="navbar-text text-white me-3">{{ tier }} Tier</span>
      <a href="{{ url_for('logout') }}" class="btn btn-outline-light">Logout</a>
    </div>
  </div>
</nav>

<div class="container mt-4">
  <h4>Add Stock Alert</h4>
  <form method="POST" action="{{ url_for('add_alert') }}">
    <div class="input-group mb-3">
      <input type="text" class="form-control" name="symbol" placeholder="Stock Symbol" required>
      <button class="btn btn-success" type="submit">Add Alert</button>
    </div>
  </form>

  <h4>Latest Alerts</h4>
  <ul class="list-group mb-4">
    {% for alert in alerts %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ alert.symbol }} - ${{ alert.price }}
        <span class="badge bg-primary rounded-pill">{{ alert.time }}</span>
      </li>
    {% else %}
      <li class="list-group-item">No alerts yet.</li>
    {% endfor %}
  </ul>

  {% for alert in alerts %}
    <div class="mb-5">
      <h5>{{ alert.symbol }} - Last 5 Days</h5>
      <canvas id="chart_{{ alert.symbol }}"></canvas>
      <script>
        const ctx_{{ alert.symbol }} = document.getElementById('chart_{{ alert.symbol }}').getContext('2d');
        new Chart(ctx_{{ alert.symbol }}, {
          type: 'line',
          data: {
            labels: {{ alert.dates|safe }},
            datasets: [{
              label: '{{ alert.symbol }} Closing Price',
              data: {{ alert.prices|safe }},
              borderColor: 'rgba(75, 192, 192, 1)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              tooltip: { mode: 'index', intersect: false }
            },
            scales: {
              x: { title: { display: true, text: 'Date' } },
              y: { title: { display: true, text: 'Price (USD)' } }
            }
          }
        });
      </script>
    </div>
  {% endfor %}
</div>

</body>
</html>
